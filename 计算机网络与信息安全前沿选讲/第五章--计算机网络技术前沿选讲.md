# 第五章--计算机网络技术前沿选讲

1. 计算机网络体系结构

   + 网络协议

     网络协议(network protocol)，简称为**协议**，是为进行网络中的数据交换而建立的规则、标准或约定。

   + 计算机网络的体系结构

     计算机网络的体系结构(architecture)是计算机网络的各层及其协议的集合。

     体系结构就是这个计算机网络及其部件所应完成的功能的精确定义。

     实现(implementation)是遵循这种体系结构的前提下用何种硬件或软件完成这些功能的问题。

     体系结构是抽象的，而实现则是具体的，是真正在运行的计算机硬件和软件。  

   + 三种体系结构

     <img src="2-1.png" alt="2-1" style="zoom:50%;" />

   + TCP/IP体系结构
     + **网络接口层**：任何可用于IP数据报交换的分组传输的链路层协议均包含在其中。
     + **网络层**：处理来自传输层的分组发送请求，处理毕发往网络接口；处理输入的数据报，进行路由选择。
     + **传输层**：提供端到端的可靠通信。
     + **应用层**：向用户提供一组由TCP/IP所制定的协议标准的常用的应用程序。

2. 网络层

   + IP地址及其表示方法

     我们把整个因特网看成为一个单一的、抽象的网络。IP 地址就是给每个连接在因特网上的主机（或路由器）分配一个在全世界范围是唯一的 32 位的标识符。

     IP 地址现在由因特网名字与号码指派公司ICANN (Internet Corporation for Assigned Names and Numbers)进行分配

     + IP地址的编址方法

       + 分类的IP 地址：这是最基本的编址方法，在 1981 年就通过了相应的标准协议。

         + 每一类地址都由两个固定长度的字段组成，其中一个字段是网络号 net-id，它标志主机（或路由器）所连接到的网络，而另一个字段则是主机号 host-id，它标志该主机（或路由器）。

         + 两级的 IP 地址可以记为：IP 地址 ::= { <网络号>, <主机号>}    

         + 点分十进制记法：128.11.3.31

         + 五类IP地址

           <img src="5-1.png" alt="2-1" style="zoom: 67%;" />

           <img src="5-2.png" alt="2-1" style="zoom: 67%;" />

           + 一些有特殊用途的IP地址
             + 网络地址（Netid=特定网络号，Hostid=0）
             + 直接广播地址（Netid=特定网络号，Hostid=全1）
             + 有限广播地址（ Netid=全1，Hostid=全1 ）
             + 本网特定主机地址（ Netid=全0，Hostid=特定主机号 ）
             + 回送地址（Netid=127, Hostid=任意值）
             + 本网络本主机（Netid=全0,Hostid=全0）

         + IP数据报格式

           + 一个 IP 数据报由首部和数据两部分组成。
           + 首部的前一部分是固定长度，共 **20 字节**，是所有 IP 数据报必须具有的。
           + 在首部的固定部分的后面是一些可选字段，其长度是可变的。

           <img src="5-3.png" alt="2-1" style="zoom: 67%;" />

           + IP数据报首部的固定分中的各字段

             + 版本：占 4 位，指 IP 协议的版本。

               目前的 IP 协议版本号为 4 (即 IPv4)

             + 首部长度：占 4 位

               可表示的最大数值，是 15 个单位(**一个单位为 4 字节**)

               因此**IP 的首部长度的最大值是 60 字节**。

             + 区分服务：占 8 位

               用来获得更好的服务

               在旧标准中叫做服务类型，但实际上一直未被使用过。

               1998 年这个字段改名为区分服务。

               只有在使用区分服务（DiffServ）时，这个字段才起作用。

               在一般的情况下都不使用这个字段 

             + 总长度：占 16 位

               指首部和数据之和的长度，

               **单位为字节**，因此数据报的最大长度为 65535 字节。

               总长度必须不超过最大传送单元 MTU。 

             + 标识(identification)  ：占 16 位

               它是一个计数器，用来产生数据报的标识

             + 标志(flag) ： 占 3 位，目前只有前两位有意义。

               标志字段的最低位是 **MF** (More Fragment)。

               + MF = 1 表示后面“还有分片”。MF = 0 表示最后一个分片。

               标志字段中间的一位是 **DF** (Don't Fragment) 。

               + 只有当 DF = 0 时才允许分片。

             + 片偏移：占13 位

               指出某片在原分组中的相对位置。

               片偏移**以 8 个字节为偏移单位**。
               + 重组

                 当分了片的IP数据报被传输到最终目标主机时，目标主机要对收到的各分片重新进行组装，以恢复成源主机发送时的IP数据报。

               + IP怎样重组乱序的分片

                 + 发送方将一个惟一的标识放进每个输出数据报的**标识域**中。当路由器对一个数据报分片时，就会将这一标识数复制到每一分片中，接收方就可利用收到的分片的标识和IP源地址来确定该段属于那个数据报。

                 + 根据偏移量确定分片在原数据报中的位置。
                 + 根据MF字段确定分片是否为最后一个分片。

             + 生存时间：占8位，记为TTL（Time To Live）

               数据报在网络中可通过的路由器数的最大值。

             + 协议：占8 位

               字段指出此数据报携带的数据使用何种协议

               以便目的主机的 IP 层将数据部分上交给哪个处理过程

               <img src="5-4.png" alt="2-1" style="zoom: 67%;" />

             + 首部校验和：占16位

               字段**只检验数据报的首部**，不检验数据部分。

               这里不采用 CRC 检验码而采用简单的计算方法。

             + 源地址和目的地址：各占4位

       + 子网的划分

         + 这是对最基本的编址方法的改进，其标准[RFC 950]在 1985 年通过。
         + 在 ARPANET 的早期，IP 地址的设计确实不够合理。
           + IP 地址空间的利用率有时很低。 
           + 给每一个物理网络分配一个网络号会使路由表变得太大因而使网络性能变坏。
           + 两级的 IP 地址不够灵活。
         + 三级的IP地址
           + 从 1985 年起在 IP 地址中又增加了一个“子网号字段”，使两级的 IP 地址变成为**三级的 IP 地址。**
           + 划分子网已成为因特网的正式标准协议。 
         + 划分子网的基本思路
           + 划分子网纯属一个单位内部的事情。单位对外仍然表现为没有划分子网的网络。
           + 从主机号借用若干个位作为子网号 subnet-id，而主机号 host-id 也就相应减少了若干个位。IP地址原来的网络号不改变
           + IP地址 ::= {<网络号>, <子网号>, <主机号>}
         + 子网掩码
           + **从一个 IP 数据报的首部并无法判断源主机或目的主机所连接的网络是否进行了子网划分。**
           + 使用子网掩码(subnet mask)可以找出 IP 地址中的子网部分。
           + (IP 地址) AND (子网掩码) =网络地址
           + 默认子网掩码
             + A类地址：255.0.0.0
             + B类地址：255.255.0.0
             + C类地址：255.255.255.0
           + 使用子网掩码的分组转发过程
             + 在不划分子网的两级 IP 地址下，从 IP 地址得出网络地址是个很简单的事。
             + 但在划分子网的情况下，从 IP 地址却不能唯一地得出网络地址来，这是因为网络地址取决于那个网络所采用的子网掩码，但数据报的首部并没有提供子网掩码的信息。
             + 因此分组转发的算法也必须做相应的改动。
             + 使用子网划分后，**路由表包括：目的网络地址、子网掩码和下一跳地址**。 
             + 路由转发分组的算法
               + 从收到的分组的首部提取目的 IP 地址 *D*。
               + 首先判断是否连在本网络上，如果是就直接交付，否则交给路由器并逐项查找路由表
               + 对路由器直接相连的网络逐个进行检查：用各网络的子网掩码和 *D* 逐位相“与”，看是否和相应的网络地址匹配。若匹配，则将分组直接交付。否则就是间接交付，执行(3)。
               + 若路由表中有目的地址为 *D* 的特定主机路由，则将分组传送给指明的下一跳路由器；否则，执行(4)。
               + 对路由表中的每一行的子网掩码和 *D* 逐位相“与”，若其结果与该行的目的网络地址匹配，则将分组传送 给该行指明的下一跳路由器；否则，执行(5)。
               + 若路由表中有一个默认路由，则将分组传送给路由表中所指明的默认路由器；否则，执行(6)。
               + 报告转发分组出错。

       + 构造超网

         + 这是比较新的无分类编址方法。1993 年提出后很快就得到推广应用。
         + 划分子网在一定程度上缓解了因特网在发展中遇到的困难。然而在 1992 年因特网仍然面临三个必须尽早解决的问题，这就是：
           + B 类地址在 1992 年已分配了近一半，眼看就要在 1994 年 3 月全部分配完毕！
           + 因特网主干网上的路由表中的项目数急剧增长（从几千个增长到几万个）。
           + 整个 IPv4 的地址空间最终将全部耗尽
           + 

         

     

   

   

   