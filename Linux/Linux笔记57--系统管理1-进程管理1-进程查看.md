# Linux笔记57--系统管理1-进程管理1-进程查看

## 进程简介

进程是正在执行的一个程序或命令，每个进程都是一个运行的实体，都有自己的地址空间，并占用一定的系统资源。

---

## 进程管理的作用

+ 判断服务器健康状态
+ 查看系统中所有进程
+ 杀死进程

---

## 查看系统中所有进程

+ ps aux

  查看系统中所有进程，使用BSD操作系统格式

  a:所有前台进程；o:所有后台进程；u:显示进程是由哪个用户产生；x 显示无控制终端的进程；

  ---

+ ps -le

  查看系统中所有进程，使用Linux标准命令格式

  l:显示详细信息；e:显示所有进程

+ ps -ef

  f:显示UID,PPID,C与STIME栏位

---

+ 输出结果

  + USER：该进程由哪个用户产生

  + PID：进程的ID号

  + PPID: 父进程ID

  + %CPU：该进程占用CPU资源百分比，占用越高，进程越耗费资源

  + %MEM：该进程占用物理内存的百分比，占用越高，进程越耗费资源

  + VSZ：该进程占用虚拟内存的大小，单位KB

  + RSS：该进程占用实际内存的大 小，单位KB

  + TTY：该进程在哪个终端中运行。

    tty1-tty7代表本地控制台终端

    tty1-tty6是本地的字符界面终端

    tty7是图形终端

    pts/0-255代表虚拟终端

  + STAT：进程状态

    R：运行

    S：睡眠

    T：停止

    s：包含子进程

    +：位于后台
  
  + START：该进程的启动时间

  + TIME：进程占用CPU的运算时间
  
  + COMMAND：进程命令名

### 实操常用

#### 找出占用CPU最高的进程

```
ps aux --sort -pcpu | less
```

--sort -pcpu : 根据CPU占用进行排序

less : 一页一页显示

```
ps aux --sort -pcpu | head -n 10
```

head -n 10 : 显示top10

#### 找出占用内存最高的进程

```
ps aux --sort -pmem | less
```

```
ps aux --sort -pmem | head -n 10
```

#### 基于CPU占用和内存占用排序

```
ps aux --sort -pcpu,+pmem | less
```

#### 查看登入服务器的用户

```
ps -eo pid, user, args
```

-e : 显示所有进程信息

-o : 参数控制输出

PID User 和 Args 参数显示PID, 运行应用的用户和该应用

#### 格式化输出root用户（真实的或有效的UID）创建的进程

```
ps -U root -u root u
```

-U 参数按真实用户ID（RUID）筛选进程，它会从用户列表中选择真实用户名或ID。真实用户即实际创建该进程的用户。

-u 参数用来筛选有效用户ID(EUID)

u 参数用来决定以针对用户的格式输出，由User, PID, %CPU, %MEM, VSZ, RSS, TTY, STAT, START, TIME 和 COMMAND这几列组成。

#### 使用ps实时监控进程状态

ps命令会显示当前系统的进程状态，但是是静态的

如果希望能实时监控，可以结合watch命令实现

```
watch -n 1 'ps aux --sort -pcpu | head -n 20'
```

---

## 查看系统健康状态

+ top [选项]

| 选项    | 含义                               |
| ------- | ---------------------------------- |
| -d 秒数 | 指定top命令每隔几秒更新。默认是3秒 |

* 在top命令的交互模式中可以执行的命令

| 命令  | 含义                          |
| ----- | ----------------------------- |
| ？或h | 显示交互模式的帮助            |
| P     | 以CPU使用率排序，默认就是此项 |
| M     | 以内存使用率排序              |
| N     | 以PID排序                     |
| q     | 退出top                       |

+ 输出信息

  + 第一行信息为任务队列信息

    | 内容                        | 说明                                           |
    | --------------------------- | ---------------------------------------------- |
    | 14:32:50                    | 系统当前时间                                   |
    | up 4:38                     | 系统的运行时间，本机已经运行4小时38分          |
    | 2 users                     | 当前登录了两个用户                             |
    | load average:0.00 0.01 0.05 | 系统在之前一分钟，五分钟，十五分钟的平均负载。 |

    注：若CPU是单核，一般认为小于1时，负载较小。如果大于1，系统已经超出负荷。

    注：若CPU是八核，一般认为小于8时，负载较小。如果大于8，系统已经超出负荷。

  + 第二行为进程信息

    | 内容            | 说明                                        |
    | --------------- | ------------------------------------------- |
    | Tasks:111 total | 系统中的进程总数                            |
    | 1 running       | 正在运行的进程数                            |
    | 108 sleeping    | 睡眠的进程数                                |
    | 2 stopped       | 正在停止的进程                              |
    | 0 zombie        | 僵尸进程数。如果不是0，需要手工检查僵尸进程 |

  + 第三行为CPU信息

    | 内容          | 说明                                                         |
    | ------------- | ------------------------------------------------------------ |
    | Cpu(s):0.0 us | 用户模式占用的CPU百分比                                      |
    | 0.3 sy        | 系统 模式占用的CPU百分比                                     |
    | 0.0 ni        | 改变过优先级的用户进程占用的CPU百分比                        |
    | 99.7 id       | 空闲CPU的CPU百分比                                           |
    | 0.0 wa        | 等待输入/输出的进程的占用CPU百分比                           |
    | 0.0 hi        | 硬中断请求服务占用的CPU百分比                                |
    | 0.0 si        | 软中断请求服务占用的CPU百分比                                |
    | 0.0 st        | st(Steal time)虚拟时间百分比。就是当有虚拟机时，虚拟CPU等待实际CPU的时间百分比。 |

  + 第四行为物理内存信息

    | 内容                 | 说明                   |
    | -------------------- | ---------------------- |
    | KiB Mem:995896 total | 物理内存总量           |
    | 335356 free          | 空闲的物理内存数量     |
    | 162348 used          | 已经使用的物理内存数量 |
    | 498192 buff/cache    | 作为缓冲的内存数量     |

  + 第五行为交换分区（swap）信息

    | 内容                   | 说明                               |
    | ---------------------- | ---------------------------------- |
    | KiB Swap:2097148 total | 交换分区（虚拟内存）的总大小       |
    | 2097148 free           | 空闲交换分区的大小                 |
    | 0 used                 | 已经使用的交互分区的大小           |
    | 629308 avail Mem       | 可用于进程下一次分配的物理内存数量 |

## 查看进程树

pstree [选项]

| 选项 | 说明               |
| ---- | ------------------ |
| -p   | 显示进程PID        |
| -u   | 显示进程的所属用户 |



