# 	LinuxTips12--cpio命令

1. cpio简介

   cpio用于建立，还原备份文件的工具

   cpio-copy files to and from archives

   cpio用于创建，解压归档文件，也可以对归档文件执行拷入烤出的动作，即向归档文件中追加文件，或从归档文件中提取文件。

2. cpio运行模式

   + copy-out模式：归档模式。此模式下，cpio向归档文件中拷入文件，即进行归档操作。它会从标准输入中读取待归档的文件，将他们归档到目标中。若为指定归档的目标将归档到标准输出中。

     在copy-out模式下，最典型的是使用find来指定待归档文件。在使用find时，最好加上“-depth”以尽可能减少可能出现的问题（目录权限问题）。

   + copy-in模式：此模式下，cpio将从归档文件中提取文件，或者列出归档文件中的文件列表。它将从标准输入中读取归档文件。
   + copy-pass模式：此模式下，cpio拷贝一个目录树（即目录中所有文件）到另一个目录下，并在目标目录下以同名的子目录存在。copy-pass是copy-in模式和copy-out模式的结合，它中途没有涉及到任何归档行为，是cpio的一个特殊用法，它从标准输入中读取拷贝内容，然后将它们复制到目标路径下。

3. 参数

   | 参数                           | 说明                                                         |
   | ------------------------------ | ------------------------------------------------------------ |
   | -0(--null)                     | 接受新增列控制字符，通常配合find指令的“-print0”参数使用      |
   | -d(--make-directories)         | 如有需要cpio会自行建立目录                                   |
   | -i(--extract)                  | 执行copy-in模式，还原备份档                                  |
   | -I <备份档>                    | （i的大写）指定备份档的名称，用来取代标准输入，也能借此通过网络使用另一台主机的保存设备读取备份档。（copy-in） |
   | -p(--pass-through)             | 执行copy-pass模式，略过备份步骤，直接将文件复制到目的目录    |
   | -o(--create)                   | 执行copy-out模式，建立备份档                                 |
   | -O <备份档>                    | 指定备份档的名称，用来取代标准输出，也能借此通过网络使用另一台主机的保存设备存放备份档(copy-out) |
   | -l(--link)                     | （小写的L）以硬链接的方式取代复制文件，可以在copy-pass模式下使用 |
   | -m(preserve-modification-time) | 不去更换文件的更改时间                                       |
   | -t(--list)                     | 将输入的内容呈现出来。可用在查看以cpio新建的文件或设备的内容 |
   | -u(--uncondidtional)           | 置换所有文件，不论日期时间的新旧与否，皆不予询问而直接覆盖（强制提取） |
   | -f(--nonmatching)              | 让cpio解开所有==不==符合范本条件的文件                       |
   | -F<备份档>(--file=<备份档>)    | 指定备份档的名称，用来取代标准输入或输出，也能借此通过网络使用另一台主机的保存设备存取文档。 |
   | -A(--append)                   | 附加到已存在的备份档中，且这个备份档必须存放在磁盘上，不能放置于磁带机里。只能使用-F或-O指定归档文件。只能用在copy-out模式下。不等价于重定向符号">>"，">>"后在归档文件中找不到追加的文件 |
   | -v(--verbose)                  | 详细显示指令的执行过程                                       |
   | -B                             | 将默认的Blocks可以增加至5120bytes，默认是512bytes。这样可以让大文件的存储速度加快 |
   | -c                             | 使用旧ASCII备份格式                                          |
   | -H<备份格式>                   | 指定备份时欲使用的备份格式                                   |
   | --quiet                        | 不显示复制了多少区块                                         |

4. “>”与"<"

   cpio会将数据整个显示到屏幕上，通过将这些输出（输出到屏幕的数据）重定向（>）到一个新的文件

   而在还原时，将备份文件读进cpio(<)进行处理

5. 基本用法

   + 备份文件

     cpio -ovB > [file|device]

   + 还原文件

     cpio -ivdu < [file|device]

   + 查看

     cpio -vt < [file|device]

6. 实例

   + 归档文件

     + 将所有符合“a*”名字条件的文件归档到a.cpio中*

       + find ./ -name "a\\" | cpio -ovB > a.cpio

       + find ./ -name a\\* | cpio -ovB -F a.cpio

       + 一般出于准确性考虑（？？尚不明确），会在find上使用"-print0"，然后在cpio上使用“--null”解析空字符

         find ./ -name a\\* -print0 | cpio -ovB --null > a.cpio

     
   
     + 归档文件并指定备份格式
   
       + cpio -H <备份格式>

         | 备份格式 | 说明                                                         |
      | -------- | ------------------------------------------------------------ |
         | bin      | 二进制格式(2147483647 bytes)                                 |
      | odc      | 旧的（posix.1）可移植格式(8589934591 bytes)                  |
         | newc     | 新的（SVR4）可移植格式，支持超过65536个节点的文件系统(4294967295 bytes) |

       + 例

         find . -print0 | cpio --null -o -H newc --quiet > ../early_cpio.img

   + 列出归档文件中的文件列表
   
     + cpio -t < a.cpio
     + cpio -t -F a.cpio
  + 只列出符合匹配格式的文件
       + cpio -t a.t* < a.cpio
    + cpio -t -F a.cpio a.t*
   
  + 列出隐藏文件（未测试）
   
    cpio -t .* < a.cpio
   
  + 既列出隐藏文件，也列出普通文件（未测试）
   
    cpio -t {.\*,*} < a.cpio
   
+ 向归档文件中追加文件
   
     + 将b.c文件手动追加到a.cpio中
       + cpio -oA -F a.cpio 
    + 输入文件名b.c
       + ctrl+D完成输入

     + 通过find命令将d.c追加到a.cpio中
   
       find -name d.c | cpio -o -A -F a.cpio
   
+ 从归档文件中提取文件
   
  注：cpio命令只能将待提取文件提取到当前目录下。
   
  注：若当前目录下有和待提取文件同名的文件，不论这个文件的时间戳是否比待提取文件更新，都不会提取，除非强制提取。
   
  注：提取后，归档文件中的待提取文件不会消失。
   
  + 从a.cpio中提取d.c文件
       + cpio -ivdu -F a.cpio d.c
    + cpio -ivdu < a.cpio d.c
   
   + 复制文件
   
     + 将/home/cxy/cpio_test下的a.c复制到/home/cxy下
       + cpio -p /home/cxy
       + 输入待复制文件 a.c
       + ctrl+D完成输入
   
     
   
   
   
   
   
   
   
   
   
   