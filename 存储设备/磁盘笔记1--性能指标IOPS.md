# 磁盘笔记1--性能指标IOPS

## 定义

* IOPS (Input/Output Per Second)即每秒的输入输出量(或读写次数)，是衡量磁盘性能的主要指标之一。
* IOPS是指单位时间内系统能处理的I/O请求数量，一般以每秒处理的I/O请求数量为单位，I/O请求通常为读或写数据操作请求。

## IOPS与吞吐量性能指标的应用场合

* **随机读写**频繁的应用，如小文件存储(图片)、OLTP数据库、邮件服务器，关注随机读写性能，IOPS是关键衡量指标。 
* **顺序读写**频繁的应用，传输大量连续数据，如电视台的视频编辑，视频点播VOD(Video On Demand)，关注连续读写性能。数据吞吐量是关键衡量指标。

IOPS和数据吞吐量适用于不同的场合，例如：

* 读取10000个1KB文件，用时10秒 Throught(吞吐量)=1MB/s ，IOPS=1000，追求IOPS；
* 读取1个10MB文件，用时0.2秒 Throught(吞吐量)=50MB/s, IOPS=5，追求吞吐量。

## IOPS计算方法

### 服务时间

磁盘的随机IO服务时间 : **服务时间 = 寻道时间 + 旋转时间 + 传输时间**。

磁盘是机械装置，如FC, SAS, SATA磁盘，转速通常为5400/7200/10K/15K rpm不等。

注：rpm(Revolutions Per minute 转/分钟)

影响磁盘的关键因素是磁盘服务时间，即磁盘完成一个I/O请求所花费的时间，它由寻道时间、旋转延迟和数据传输时间三部分构成。

#### 寻道时间 Tseek

寻道时间是指将读写磁头移动至正确的磁道上所需要的时间。

寻道时间越短，I/O操作越快，目前磁盘的平均寻道时间一般在3－15ms。

##### 常见磁盘平均物理寻道时间为

* 7200转/分的STAT硬盘平均物理寻道时间是9ms；

* 10000转/分的STAT硬盘平均物理寻道时间是6ms；

* 15000转/分的SAS硬盘平均物理寻道时间是4ms。

#### 旋转延迟 Trotation

旋转延迟是指盘片旋转将请求数据所在扇区移至读写磁头下方所需要的时间。

旋转延迟取决于磁盘转速，通常使用磁盘旋转一周所需时间的1/2表示。

比如，7200 rpm的磁盘平均旋转延迟大约为60*1000/7200/2 = 4.17ms，而转速为15000 rpm的磁盘其平均旋转延迟为2ms。

##### 常见硬盘的旋转延迟时间为：

* 7200 rpm的磁盘平均旋转延迟大约为60*1000/7200/2 = 4.17ms；*
* 10000 rpm的磁盘平均旋转延迟大约为60*1000/10000/2 = 3ms；
* 15000 rpm的磁盘其平均旋转延迟约为60*1000/15000/2 = 2ms。

#### 数据传输时间 Ttransfer

数据传输时间是指完成传输所请求的数据所需要的时间，它取决于数据传输率，其值等于数据大小除以数据传输率。

目前IDE/ATA能达到133MB/s，SATA II可达到300MB/s的接口数据传输率，数据传输时间通常远小于前两部分消耗时间。

### 最大IOPS的理论计算方法

IOPS = 1000 ms/ (寻道时间 + 旋转延迟)。可以忽略数据传输时间。

* 7200 rpm的磁盘IOPS = 1000 / (9 + 4.17) = 76 IOPS；
* 10000 rpm的磁盘IOPS = 1000 / (6+ 3) = 111 IOPS；
* 15000 rpm的磁盘IOPS = 1000 / (4 + 2) = 166 IOPS。

测量中，IOPS数值会受到很多因素的影响，包括I/O负载特征(读写比例，顺序和随机，工作线程数，队列深度，数据记录大小)、系统配置、操作系统、磁盘驱动等等。

因此对比测量磁盘IOPS时，必须在同样的测试基准下进行，即便如此也会产生一定的随机不确定性。